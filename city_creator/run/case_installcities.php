<?php
	$sop = httpget('sop');
	if( $sop == 'install' )
	{
		$cities = httppost('cities');
		$allcities = httppost('allcities');
		$fields = "`cityname`,`citytype`,`cityauthor`,`citytext`,`stabletext`,`armortext`,`weaponstext`,`mercenarycamptext`,`cityblocknavs`,`module`";

		if( $cities['city0'] == 1 || $allcities == 1 )
		{
			db_query("INSERT INTO " . db_prefix('cities') . " ($fields) VALUES ('Romar','City','Eric Stevens','".mysql_real_escape_string(serialize(array('title'=>'Romar, City of Men','text'=>"`&`c`bRomar, City of Men`b`c`n`7You are standing in the heart of Romar. Though called a city, this stronghold of humans is little more than a fortified village. The city's low defensive walls are surrounded by rolling plains which gradually turn into thick forest in the distance. Some residents are engaged in conversation around the well in the village square.`n",'clock'=>"`n`7The great sundial at the heart of the city reads `&%s`7.`n",'newest1'=>"`n`7As you wander your new home, you feel your jaw dropping at the wonders around you.",'newest2'=>"`n`7Wandering the village, jaw agape, is `&%s`7.",'sayline'=>'says','talk'=>"`n`&Nearby some villagers talk:`n",'stablename'=>"Bertold's Bestiary",'gatenav'=>'Village Gates')))."','".mysql_real_escape_string(serialize(array('title'=>"Bertold's Bestiary",'desc'=>"`6Just outside the outskirts of the village, a training area and riding range has been set up.`n`nMany people from all across the land mingle as Bertold, a strapping man with a wind-weathered face, extols the virtues of each of the creatures in his care.`n`nAs you approach, Bertold smiles broadly, \"`^Ahh! how can I help you today?`6\" he asks in a booming voice.",'lad'=>'friend','lass'=>'friend','nosuchbeast'=>"`6\"`^I'm sorry, I don't stock any such animal.`6\", Bertold say apologetically.",'finebeast'=>"`6\"`^Yes, yes, that's one of my finest beasts!`6\" says Bertold.`n`n`6\"`^Not even Merick has a finer specimen than this!`6\" Bertold boasts.`n`n`6\"`^Doesn't this one have fine musculature?`6\" he asks.`n`n`6\"`^You'll not find a better trained creature in all the land!`6\" exclaims Bertold.`n`n`6\"`^And a bargain this one'd be at twice the price!`6\" booms Bertold.`n`n",'toolittle'=>"`6Bertold looks over the gold and gems you offer and turns up his nose, \"`^Obviously you misheard my price. This %s will cost you `&%s `^gold  and `%%s`^ gems and not a penny less.`6\"",'replacemount'=>"`6Patting %s`6 on the rump, you hand the reins as well as the money for your new creature, and Bertold hands you the reins of a `&%s`6.",'newmount'=>"`6You hand over the money for your new creature, and Bertold hands you the reins of a new `&%s`6.",'nofeed'=>"`6\"`^I'm terribly sorry %s, but I don't stock feed here. I'm not a common stable after all!  Perhaps you should look elsewhere to feed your creature.`6\"",'nothungry'=>"`&%s`6 picks briefly at the food and then ignores it. Bertold, being honest, shakes his head and hands you back your gold.",'halfhungry'=>"`&%s`6 dives into the provided food and gets through about half of it before stopping. \"`^Well, %s wasn't as hungry as you thought.`6\" says Bertold as he hands you back all but %s gold.",'hungry'=>"`6%s`6 seems to inhale the food provided. %s`6, the greedy creature that it is, then goes snuffling at Bertold's pockets for more food.`nBertold shakes his head in amusement and collects `&%s`6 gold from you.",'mountfull'=>"`n`6\"`^Well, %s, your %s`^ is full up now.  Come back tomorrow if it hungers again, and I'll be happy to sell you more.`6\" says Bertold with a genial smile.",'nofeedgold'=>"`6\"`^I'm sorry, but that is just not enough money to pay for food here.`6\" Bertold turns his back on you, and you lead %s away to find other places for feeding.",'confirmsale'=>"`n`n`6Bertold eyes your mount up and down, checking it over carefully. \"`^Are you quite sure you wish to part with this creature?`6\"",'mountsold'=>"`6With but a single tear, you hand over the reins to your %s`6 to Bertold's stableboy.  The tear dries quickly, and the %s in hand helps you quickly overcome your sorrow.",'offer'=>"`n`n`6Bertold strokes your creature's flank and offers you `&%s`6 gold and `%%s`6 gems for %s`6.")))."','','','','".mysql_real_escape_string(serialize(array('train'=>1,'mercenarycamp'=>1,'inn'=>1,'rock'=>1,'clans'=>1,'hof'=>1)))."','city_creator')");
			if( db_affected_rows() > 0 ) output('`&The City of Romar has been `@successfully `&installed.`0`n');
			else output('`&The City of Romar `$failed `&to install.`0`n');
		}
		if( $cities['city1'] == 1 || $allcities == 1 )
		{
			db_query("INSERT INTO " . db_prefix('cities') . " ($fields) VALUES ('Glorfindal','City','Eric Stevens','".mysql_real_escape_string(serialize(array('title'=>'Glorfindal City','text'=>"`^`c`bGlorfindal, Ancestral Home of the Elves`b`c`n`6You stand on the forest floor. Glorfindal rises about you, appearing to be one with the forest. Ancient, frail-looking buildings appear to grow from the forest floor, the tree limbs, and on the very treetops. The magnificent trees clutch delicately to these homes of elves. Bright motes of light swirl around you as you move about.`n",'clock'=>"`n`6Capturing one of the tiny lights, you peer delicately into your hands.`nThe fairy within tells you that it is `^%s`6 before disappearing in a tiny sparkle.`n",'newest1'=>"`n`6You stare around in wonder at the excessively tall buildings and feel just a bit queasy at the prospect of looking down from those heights.",'newest2'=>"`n`6Looking at the buildings high above, and looking a little queasy at the prospect of such heights is `^%s`6.",'sayline'=>'converses','talk'=>"`n`^Nearby some villagers converse:`n",'gatenav'=>'Village Gates','fightnav'=>'Honor Avenue','marketnav'=>'Mercantile','tavernnav'=>'Towering Halls','weaponshop'=>"Gadriel's Weapons")))."','','','".mysql_real_escape_string(serialize(array('title'=>"Gadriel's Weapons",'desc'=>"`7The Elven Ranger pads gracefully towards you as you enter, examining you from head to foot, an expression of piqued interest upon his fine elven features.`n`nThe tiny elf has magnificent blond hair reaching almost to his knees, and he spends a long moment memorizing your every facial feature.`n`nGleaming eyes narrow as his assessment is concluded, and his face becomes a hardened mask which sets your teeth on edge. Despite his tiny stature, you feel intimidated, and he revels in your discomfort.`n`n`7Speaking at last, his words are measured and calculated. `5\"You have shown surprising intelligence,`7\" he barks coldly, `5\"for having sought the finest workmanship in all the lands. No other being can hope to posess the grace and pure power of we Elves. No other weapons have one tenth the nobility and quality of what you see here. And no creature shall wield them as well as an Elf would, though you may try as you might.`7\"`7You attempt bravado in the face of such arrogance, and thrust forward your weapon for inspection.`n`n",'tradein'=>"`5Gadriel`7 takes your weapon and examines it again quitely. After some seconds he gives it back to you with a cold look in his eyes.`n`n`5\"`^%T`5 gold is all I can give you for this.\"`7, he says.`n`n",'payweapon'=>"Gadriel takes your `5%s`7 and puts it on a rack behind him. Then, with a flourish, he pick up a new `5%s`7, deftly demonstrating its use, before handing it to you with gallantry and grace.")))."','','".mysql_real_escape_string(serialize(array('train'=>1,'mercenarycamp'=>1,'inn'=>1,'rock'=>1,'stables'=>1,'clans'=>1,'hof'=>1)))."','city_creator')");
			if( db_affected_rows() > 0 ) output('`&The City of Glorfindal has been `@successfully `&installed.`0`n');
			else output('`&The City of Glorfindal `$failed `&to install.`0`n');
		}
		if( $cities['city2'] == 1 || $allcities == 1 )
		{
			db_query("INSERT INTO " . db_prefix('cities') . " ($fields) VALUES ('Qexelcrag','Caverns','Eric Stevens','".mysql_real_escape_string(serialize(array('title'=>'The Caverns of Qexelcrag','text'=>"`#`c`bCavernous Qexelcrag, home of the dwarves`b`c`n`3Deep in the heart of Mount Qexelcrag lie the ancient caverns that the Dwarves have called home for centuries. Colossal columns, covered with deeply carved geometric shapes, stretch up into the darkness, supporting the massive weight of the mountain above. All around you, stout dwarves discuss legendary treasures and drink heartily from mighty steins, which they readily fill from tremendous barrels nearby.`n",'clock'=>"`n`3A cleverly crafted crystal prism allows a beam of light to fall through a crack in the great ceiling.`nIt illuminates age old markings carved into the cavern floor, telling you that on the surface it is `#%s`3.`n",'newest1'=>"`n`3Being rather new to this life, you pound an empty stein against an ale keg in an attempt to get some of the fabulous ale therein.",'newest2'=>"`n`3Pounding an empty stein against a yet unopened barrel of ale, wondering how to get to the sweet nectar inside is `#%s`3.",'sayline'=>'brags','talk'=>"`n`#Nearby some villagers brag:`n",'gatenav'=>'Village Gates','fightnav'=>"Th' Arena",'marketnav'=>'Ancient Treasures','tavernnav'=>'Ale Square','mercenarycamp'=>'A Bestiarium')))."','','','','".mysql_real_escape_string(serialize(array('title'=>'A Bestiarium','desc'=>"`5You are making your way to the Bestiarium deep in the bowels of the dwarven mountain stronghold. The sounds of a massive struggle echo off the hewn rock walls of the cavernous passageway. Scuffling is punctuated with the sounds of snarling and the impact of a heavy body slamming into another.`n`nAs you round the corner you find yourself at the edge of an arena. Around the walls are carved out stalls which contain beasts of various shapes, sizes and abilities.`n`nIn the arena, a `&white wolf `5whose size equals that of a mountain pony is lunging towards a massive `~black bear`5. `~The bear`5 on his hind legs stands as tall as an oak. It raises a paw as `&the wolf `5leaps towards him, then with a movement so quick you nearly miss it, `&the wolf `5is batted away to fall on its side. Apparently enraged, `&the wolf`5 leaps snarling to its feet to prepare to lunge again.`n`nAt that moment a stocky dwarf standing at the edge of the arena raises his finger and thumb to his mouth. A piercing whistle cuts through the air. `~The black bear `5lowers himself to all fours and shakes his body, then yawns. `&The white wolf `5pauses, then lays down with his tongue hanging in a pant. Its yellow eyes never leaving you as you walk towards the dwarf.`n`n\"`tGreetings, Dwalin!`5\" you call out as you approach. \"`tI am in need of a beast to accompany me on my adventures. What do you have available this day?`5\"`n`n",'buynav'=>'Buy a Beast')))."','".mysql_real_escape_string(serialize(array('train'=>1,'inn'=>1,'rock'=>1,'stables'=>1,'clans'=>1,'hof'=>1)))."','city_creator')");
			if( db_affected_rows() > 0 ) output('`&The Caverns of Qexelcrag has been `@successfully `&installed.`0`n');
			else output('`&The Caverns of Qexelcrag `$failed `&to install.`0`n');
		}
		if( $cities['city3'] == 1 || $allcities == 1 )
		{
			db_query("INSERT INTO " . db_prefix('cities') . " ($fields) VALUES ('Glukmoore','Swamps','Eric Stevens','".mysql_real_escape_string(serialize(array('title'=>'The Swamps of Glukmoore','text'=>"`@`b`cGlukmoore, Home of the Trolls`c`b`n`2You are standing in a pile of mud, in the heart of a vast swamp. Around you are the fetid skin-covered hovels that trolls call home. Well actually, they call them 'ughrrnk', but that's a bit hard on the throats of non-trolls. Nearby some local peasants squabble over the rapidly decaying remains of the morning's hunt. Perched atop one of the huts, a badly scarred troll smears indescribable filth over his home's surface in an ill fated attempt to water proof it.`n",'clock'=>"`n`2Based on what's left of the morning's kill, you can tell that it is `@%s`2.`n",'newest1'=>"`n`2You wander the village, picking your teeth with the tiny rib of one of your siblings. Flicking off a bit of shell that was still stuck to your skin, you watch as it skips several times across the muddy surface of the swamp before a small lizard jumps on it and begins to consume its nutrients.",'newest2'=>"`n`2Picking their teeth with a sliver of bone is `@%s`2, still covered with bits of shell from the hatchery.",'talk'=>"`n`@Nearby some villagers squabble:`n",'sayline'=>'squabbles','gatenav'=>'Village Gates','fightnav'=>'Barshem Gud','marketnav'=>'Da Gud Stuff','tavernnav'=>"Eatz n' Such",'infonav'=>'Da Infoz')))."','','','','','".mysql_real_escape_string(serialize(array('train'=>1,'mercenarycamp'=>1,'inn'=>1,'rock'=>1,'stables'=>1,'clans'=>1,'hof'=>1)))."','city_creator')");
			if( db_affected_rows() > 0 ) output('`&The Swamps of Glukmoore has been `@successfully `&installed.`0`n');
			else output('`&The Swamps of Glukmoore `$failed `&to install.`0`n');
		}
	}
	else
	{
		require_once('lib/showform.php');

		output("`3Which of the following cities do you wish to install?.`n`n");

		$row = array(
			'allcities'=>'',
			'cities'=>array()
		);
		$form = array(
			'Install Which Cities?,title',
			'allcities'=>'Install ALL cities?,bool',
			'cities'=>'Cities:,checklist,city0,'.appoencode('`Q').'Romar,city1,'.appoencode('`2').'Glorfindal,city2,'.appoencode('`e').'Qexelcrag,city3,'.appoencode('`@').'Glukmoore'
		);

		rawoutput('<form action="runmodule.php?module=city_creator&op=installcities&sop=install" method="POST">');
		addnav('','runmodule.php?module=city_creator&op=installcities&sop=install');
		showform($form,$row);
		rawoutput('</form>');
	}

	addnav('Editor');
	addnav('Add a City',$from.'&op=edit');
	addnav('Main Page',$from);
?>